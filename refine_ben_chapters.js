import fs from 'fs';
import path from 'path';

const cachePath = 'translations_cache.json';
const cache = JSON.parse(fs.readFileSync(cachePath, 'utf8'));

// Provide a powerful English/Bengali literal -> Islamic translation dictionary
const glossary = {
  // Common terms Fixes
  "অন্ত্যেষ্টিক্রিয়া": "দাফন",
  "অন্ত্যেষ্টিক্রিয়া সংক্রান্ত অধ্যায়": "দাফন সংক্রান্ত অধ্যায়",
  "প্রার্থনার বই - বৃষ্টি": "বৃষ্টি প্রার্থনার নামাযের কিতাব",
  "বৃষ্টির জন্য প্রার্থনার বই": "বৃষ্টি প্রার্থনার নামাযের কিতাব",
  "প্রার্থনার বই - ভ্রমণকারী": "সফরের নামাযের কিতাব",
  "নামাযের কিতাব - শুক্রবার": "জুমার নামাযের কিতাব",
  "নামাজের কিতাব- দুই ঈদ": "ঈদের নামাযের কিতাব",
  "প্রার্থনা বই - Eclipses": "গ্রহণ সংক্রান্ত নামাযের কিতাব",
  "নামাজের বই - জানাজা": "দাফন ও জানাযার নামাযের কিতাব",
  "বই": "কিতাব", // Overarching change, but need to be careful not to corrupt. Better map the prefixes.
  "প্রার্থনা": "নামায",
  "নামাজ": "নামায",
  "নামাজের": "নামাযের",
  "প্রার্থনার": "নামাযের",
  "শুদ্ধিকরণ": "পবিত্রতা (তাহারাত)",
  "শুদ্ধিকরণের": "পবিত্রতার",
  "বিশুদ্ধতা": "পবিত্রতা",
  "দিয়াত (ব্লাড মানি)": "রক্তপণ (দিয়াত)",
  "রক্ত-মানি": "রক্তপণ (দিয়াত)",
  "রক্ত-বুদ্ধির প্রকার": "রক্তপণ (দিয়াত)",
  "ব্লাড মানি": "রক্তপণ (দিয়াত)",
  "উইলস": "অসিয়ত",
  "উইল এবং টেস্টামেন্ট": "অসিয়ত",
  "দান": "সাদাকা",
  "দাতব্য": "সাদাকা ও যাকাত",
  "বাধ্যতামূলক দাতব্য কর": "যাকাত (ফরজ দান)",
  "জাকাত": "যাকাত",
  "ডিভোর্স": "তালাক",
  "উপবাস": "রোযা (সিয়াম)",
  "রোজা": "রোযা",
  "রোজার": "রোযার",
  "খেলা": "শিকার", // "Game" translates to খেলা but in this context it's شکار
  "দাসদের মানুমিশনের বই": "দাসমুক্তির কিতাব",
  "আদব ও শিষ্টাচার": "শিষ্টাচার (আদাব)",
  "সাধারণ আচরণ": "শিষ্টাচার (আদাব)",
  "বাণিজ্যিক লেনদেন": "ব্যবসা-বাণিজ্য",
  "মজুরি": "ইজারা (ভাড়া ও মজুরি)",
  "ভবিষ্যদ্বাণী এবং অশুভ": "ভবিষ্যদ্বাণী ও অশুভ লক্ষণ",
  "পরীক্ষা এবং ভয়ানক যুদ্ধ": "ফিতনা ও মহাযুদ্ধ",
  "প্রতিশ্রুত বিতরণকারী": "প্রতিশ্রুত ইমাম (মাহদী)",
  "নির্ধারিত শাস্তি": "দণ্ডবিধি (হুদূদ)",
  "আইনি শাস্তি": "দণ্ডবিধি (হুদূদ)",
  "উদ্ঘাটন": "ওহী",
  "বিশ্বাস": "ঈমান",
  "অযু": "ওযু",
  "গোসল": "গোসল",
  "মাসিকের সময়কাল": "হায়েয ও নিফাস (মাসিকের সময়কাল)",
  "মাসিকের": "হায়েযের (মাসিকের)",
  "হাত-পা ধুলা মাখা": "তায়াম্মুম",
  "নামাযের আহবান": "আযান",
  "নামাজকে ভয় করুন": "যুদ্ধাবস্থায় নামাযের বর্ণনা (সালাতুল খাউফ)",
  "ভয় প্রার্থনা": "যুদ্ধাবস্থায় নামাযের বর্ণনা (সালাতুল খাউফ)",
  "দুটি উৎসব": "দুই ঈদ",
  "গ্রহন": "সূর্য ও চন্দ্রগ্রহণ",
  "নামায সংক্ষিপ্ত করা": "নামায কসর (সংক্ষিপ্ত) করা",
  "রাতের নামাজ": "রাতের নামায (তাহাজ্জুদ)",
  "অন্ত্যেষ্টিক্রিয়া (আল-জানা'ইজ)": "দাফন",
  "তীর্থযাত্রা": "হজ্জ",
  "তীর্থযাত্রীদের": "হাজীদের",
  "‘উমরাহ (ছোট তীর্থযাত্রা)": "উমরাহ",
  "রমজানের রাতে (তারাবীহ) নামাজ পড়া": "তারাবীহ নামায",
  "প্রার্থনায় বিস্মৃতি": "সাহু (নামাযে ভুলভ্রান্তি)",
  "বিস্মৃতির বই (প্রার্থনায়)": "সাহু (নামাযে ভুলভ্রান্তি) সংক্রান্ত কিতাব",
  "কদরের রাতের ফজিলত": "লাইলাতুল কদরের ফজিলত",
  "যে বিক্রয়ে পণ্যের জন্য মূল্য পরিশোধ করা হয় যা পরে বিতরণ করা হবে (আস-সালাম)": "অগ্রিম মূল্য পরিশোধে বিক্রয় (আস-সালাম)",
  "খুসুমাত": "বিবাদ-মীমাংসা (খুসুমাত)",
  "লুকাতাহ": "হারানো বস্তু খুঁজে পাওয়া (লুকাতাহ)",
  "নিপীড়ন": "জুলুম-নির্যাতন",
  "অংশীদারিত্ব": "অংশীদারিত্ব (শিরকাত)",
  "বন্ধক রাখা": "বন্ধক (রহন)",
  "ক্রীতদাসদের ম্যানুমিশন": "দাসমুক্তি",
  "মাকাতিব": "মুকাতাব (চুক্তিবদ্ধ দাস)",
  "শর্তাবলী": "শর্তসমূহ",
  "জিযিয়া ও মাওয়াদাহ": "জিযিয়া কর ও সন্ধি",
  "সৃষ্টির সূচনা": "সৃষ্টির সূচনা বিবরণ",
  "নবীগণ": "নবীগণ (আলাইহিমুস সালাম)",
  "সাহাবায়ে কেরাম রা": "সাহাবায়ে কিরাম (রাদিয়াল্লাহু আনহুম)",
  "কুরআনের ভবিষ্যদ্বাণীমূলক তাফসীর": "কুরআনের তাফসীর",
  "বিবাহ, বিবাহ (নিকাহ)": "বিবাহ (নিকাহ)",
  "পরিবার সমর্থন": "পরিবারের ভরণপোষণ",
  "জন্মের সময় কোরবানি (আকীকা)": "আকীকা",
  "আল-আধা উৎসব বলিদান (আদাহি)": "কুরবানী (আদাহী)",
  "রোগীদের": "রোগী ও চিকিৎসা",
  "অনুমতি চাচ্ছে": "অনুমতি প্রার্থনা",
  "আমন্ত্রণ": "দোয়া ও যিকর",
  "হৃদয়কে কোমল করা (আর-রিকাক)": "অন্তর গলানো বিষয়াদি (রিকাক)",
  "ঐশ্বরিক ইচ্ছা (আল-কদর)": "তাকদীর (কদর)",
  "অপূর্ণ শপথের কাফফারা": "শপথের কাফফারা",
  "উত্তরাধিকার আইন (আল-ফারায়িদ)": "উত্তরাধিকার আইন (ফারায়েয)",
  "আল্লাহ কর্তৃক নির্ধারিত সীমা ও শাস্তি (হুদূদ)": "দণ্ডবিধি (হুদূদ)",
  "ধর্মত্যাগী": "মুরতাদ (ধর্মত্যাগী)",
  "(বিবৃতি অধীনে করা) জবরদস্তি": "জোরপূর্বক বাধ্য করা",
  "কৌশল": "কৌশল (হিয়াল)",
  "দুর্দশা এবং বিশ্বের শেষ": "ফিতনা ও মহাপ্রলয়",
  "বিচার (আহকাম)": "ইসলামী হুকুম-আহকাম",
  "শুভেচ্ছা": "সালাম ও শুভেচ্ছা",
  "সত্যবাদী ব্যক্তির দেওয়া তথ্য গ্রহণ করা": "সত্যবাদীর সংবাদ গ্রহণ",
  "আল্লাহর একত্ব, অদ্বিতীয়তা (তাওহীদ)": "তাওহীদ (একত্ববাদ)",
  "দ্য ইভিল আই": "বদ নজর",
  "দর্শন": "দর্শন ও স্বপ্ন",
  "দ্য বুক অফ ইনভোকিং কার্সেস": "লিয়ান সংক্রান্ত কিতাব",
  "দ্য বুক অফ লস্ট প্রপার্টি": "কুড়িয়ে পাওয়া বস্তুর কিতাব",
  "দ্য বুক অফ ডেস্টিনি": "তাকদীর (কদর) সংক্রান্ত কিতাব",
  "দ্য বুক অফ প্রেজেন্টস": "উপহার সংক্রান্ত কিতাব",
  "মহিলাদের প্রতি সদয় আচরণের বই": "নারীদের প্রতি সদাচরণ",
  "যুদ্ধের বই [রক্তপাত নিষিদ্ধ]": "যুদ্ধ ও রক্তপাত নিষিদ্ধকরণ সংক্রান্ত কিতাব",
  "বিচারকদের শিষ্টাচারের বই": "বিচারকের শিষ্টাচার",
  "অধ্যায়": "অধ্যায়", // Keep it intact
  "বক্তৃতা": "বক্তব্য",
  "মিনতি": "মুনাজাত ও দোয়া",
  "ক্লেশ": "ফিতনা",
  "জুহদ": "যুহদ (দুনিয়াবিরাগী)",
  "জুমুআ": "জুমুআ",
  "দুই আইডি": "দুই ঈদ",
  "বৃষ্টি চাইছে": "বৃষ্টি চাওয়ার নামায (ইসতিসকা)",
  "সমাধি": "কবর ও দাফন",
  "স্তন্যপান করা": "দুধ পান (রযাআহ)",
  "শেয়ারক্রপিং": "জমি বর্গা বা মুযারাআহ",
  "পশু জবাই করা": "পশু জবাই করা (যবেহ)",
  "সম্পত্তিতে প্রাক-খালি": "সম্পত্তিতে অধিকার (শুফআহ)",
  "মুক্তাব": "মুকাতাব",
  "ডিক্রি": "ফয়সালা",
  "ভ্রমণকারী": "মুসাফির",
  "অধীনে করা": ""
};

const benCache = cache['ben'];
if (benCache) {
  for (let key in benCache) {
    let text = benCache[key];

    // Exact mapping for titles like "The Book Of..." to "... এর কিতাব"
    text = text.replace(/The Book of /ig, '');
    text = text.replace(/The Book On /ig, '');
    text = text.replace(/The Chapters on /ig, '');
    text = text.replace(/Chapters On /ig, '');

    // Replace terms based on glossary
    for (const [englishOrLiteral, islamicTerm] of Object.entries(glossary)) {
      // Create a global replacement, ignoring case if needed
      text = text.split(englishOrLiteral).join(islamicTerm);
    }

    // Normalize "বই" to "কিতাব" strictly for book names
    text = text.replace(/ বই/g, ' কিতাব');
    text = text.replace(/^বই /g, 'কিতাব ');
    text = text.replace(/দ্য বুক অফ /g, '');
    text = text.replace(/এর কিতাব/g, 'সংক্রান্ত কিতাব');

    benCache[key] = text;
  }
}

fs.writeFileSync(cachePath, JSON.stringify(cache, null, 2));
console.log('Successfully refined Bengali translations based on Islamic glossary.');
